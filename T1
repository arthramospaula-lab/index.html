<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telescópio 3D — Demo</title>
  <style>
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:#001430;color:#fff}
    #container{width:100%;height:100vh;display:block;position:relative;overflow:hidden}
    .ui{position:absolute;right:12px;top:12px;background:rgba(0,0,0,0.55);padding:10px;border-radius:8px;color:#fff;backdrop-filter:blur(4px);z-index:40}
    .credits{position:absolute;left:12px;bottom:12px;color:rgba(255,255,255,0.7);font-size:13px;z-index:40}
    label{display:block;margin-bottom:8px}
    input[type=range]{width:160px}
    #error{position:absolute;left:12px;top:120px;right:12px;padding:12px;border-radius:8px;background:#7a001f66;color:#fff;display:none;z-index:50}
    #log{position:absolute;left:12px;top:220px;right:12px;padding:12px;border-radius:8px;background:#00000066;color:#fff;max-height:40vh;overflow:auto;display:none;z-index:50}
  </style>
</head>
<body>
  <div id="container"></div>

  <div class="ui">
    <label>Comprimento do tubo <input id="tubeLen" type="range" min="1" max="6" step="0.1" value="3"></label>
    <label>Diâmetro do tubo <input id="tubeRad" type="range" min="0.2" max="1.5" step="0.05" value="0.45"></label>
    <label>Visibilidade das pernas <input id="legs" type="checkbox" checked></label>
  </div>

  <div class="credits">Telescópio 3D — Demo</div>

  <div id="error"></div>
  <pre id="log"></pre>

  <!-- Three.js (UMD) e OrbitControls via CDN (funciona no GitHub Pages) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

  <script>
    function webglAvailable() {
      try {
        var canvas = document.createElement('canvas');
        return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
      } catch (e) {
        return false;
      }
    }
    function showError(msg){ document.getElementById('error').style.display='block'; document.getElementById('error').textContent=msg; document.getElementById('log').style.display='block'; document.getElementById('log').textContent += msg + '\n'; console.error(msg); }
    function addLog(msg){ document.getElementById('log').style.display='block'; document.getElementById('log').textContent += msg + '\n'; console.log(msg); }

    if (!webglAvailable()) {
      showError('WebGL não disponível neste navegador. Abra no Chrome/Firefox ou em um navegador com suporte a WebGL.');
    } else {
      addLog('WebGL OK — inicializando Three.js...');
      (function init(){
        const container = document.getElementById('container');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x00081a, 0.06);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.set(6,2.2,6);

        const renderer = new THREE.WebGLRenderer({ antialias:true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.target.set(0,0.7,0);

        const hemi = new THREE.HemisphereLight(0xffffff, 0x091c3b, 0.5); scene.add(hemi);
        const dir = new THREE.DirectionalLight(0xffffff, 0.9); dir.position.set(5,10,5); dir.castShadow = true; scene.add(dir);

        const ground = new THREE.Mesh(new THREE.PlaneGeometry(40,40), new THREE.MeshStandardMaterial({color:0x06122a, roughness:0.9}));
        ground.rotation.x = -Math.PI/2; ground.receiveShadow = true; scene.add(ground);

        const metalMat = new THREE.MeshStandardMaterial({ color: 0x2b3036, metalness: 0.9, roughness: 0.35 });
        const blackMat = new THREE.MeshStandardMaterial({ color: 0x070707, metalness: 0.6, roughness: 0.6 });
        const glassMat = new THREE.MeshPhysicalMaterial({ color: 0x88ccee, metalness:0, roughness:0.05, transmission:0.8, transparent:true, ior:1.45 });
        const woodMat = new THREE.MeshStandardMaterial({ color: 0x664422, metalness:0.1, roughness:0.8 });

        const telescope = new THREE.Group(); scene.add(telescope);

        function rebuildTube(length=3, radius=0.45){
          while(telescope.children.length) telescope.remove(telescope.children[0]);
          const tube = new THREE.Mesh(new THREE.CylinderGeometry(radius, radius, length, 48,1,true), blackMat);
          tube.rotation.z = Math.PI/2; tube.position.set(0,1.2,0); telescope.add(tube);
          const fr = new THREE.Mesh(new THREE.CylinderGeometry(radius+0.03, radius+0.03, 0.06, 48), metalMat);
          fr.rotation.z = Math.PI/2; fr.position.set(length/2,1.2,0); telescope.add(fr);
          const ln = new THREE.Mesh(new THREE.CircleGeometry(Math.max(radius-0.03,0.01),64), glassMat);
          ln.rotation.y = Math.PI/2; ln.position.set(length/2 + 0.02,1.2,0); telescope.add(ln);
          const ep = new THREE.Mesh(new THREE.CylinderGeometry(0.12,0.18,0.55,24), blackMat);
          ep.rotation.z = Math.PI/2; ep.position.set(-length/2 - 0.05,1.2,0); telescope.add(ep);
          const fc = new THREE.Mesh(new THREE.CylinderGeometry(0.08,0.08,0.22,20), metalMat);
          fc.rotation.z = Math.PI/2; fc.position.set(-length/4,1.2,0); telescope.add(fc);
        }

        const tripod = new THREE.Group(); tripod.position.set(0,0,0); scene.add(tripod);
        const legGeom = new THREE.CylinderGeometry(0.05,0.05,2.2,16);
        const leg1 = new THREE.Mesh(legGeom, woodMat); leg1.position.set(0.8,-0.1,0.4); leg1.rotation.z = -Math.PI/4.6; tripod.add(leg1);
        tripod.add(leg1.clone().position.set(-0.8,-0.1,0.4));
        tripod.add(leg1.clone().position.set(0,-0.1,-0.9));

        rebuildTube(3,0.45);

        document.getElementById('tubeLen').addEventListener('input', function(){ rebuildTube(parseFloat(this.value), parseFloat(document.getElementById('tubeRad').value)); });
        document.getElementById('tubeRad').addEventListener('input', function(){ rebuildTube(parseFloat(document.getElementById('tubeLen').value), parseFloat(this.value)); });
        document.getElementById('legs').addEventListener('change', function(){ tripod.visible = this.checked; });

        (function animate(){ requestAnimationFrame(animate); controls.update(); renderer.render(scene, camera); })();

        window.addEventListener('resize', function(){ camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
        addLog('Cena iniciada.');
      })();
    }
  </script>
</body>
</html>
